var dieFormulas=["","","","","","","","","",""],dieTotals=["","","","","","","","","",""];function attachEvents(){for(let e=0;e<10;e++){let t=document.getElementById("diebox["+e+"]");t.addEventListener("keydown",function(e){"Enter"==e.key&&t.blur()}),t.addEventListener("change",function(){updateFormula(e)}),t.addEventListener("focus",function(){showFormula(e)}),t.addEventListener("blur",function(){showTotal(e)})}document.addEventListener("keydown",function(e){"Enter"==e.key&&rollDie()})}function rollDie(){let e,t,o,n,a,l,d,u;for(e=0;e<10;e++)if(""!=dieFormulas[e]){for(o=dieFormulas[e].match(/[0-9]+/g),n=Number(o[0]),a=Number(o[1]),d=0,u="",t=0;t<n;t++)d+=Math.floor(Math.random()*a+1);3==o.length&&(1==n&&20==a&&(u=" ("+d+")"),l=Number(o[2]),dieFormulas[e].search(/\+/g)>0&&(d+=l),dieFormulas[e].search("-")>0&&(d-=l)),dieTotals[e]=d+u,showTotal(e)}else dieTotals[e]=""}function showFormula(e){document.getElementById("diebox["+e+"]").value=dieFormulas[e]}function showTotal(e){let t=document.getElementById("diebox["+e+"]");""!=dieTotals[e]&&(t.value="="+dieTotals[e])}function updateFormula(e){let t=document.getElementById("diebox["+e+"]");if(!/^([0-9]+)d([0-9]+)([\+-][0-9]+){0,1}$/gi.test(t.value))return dieFormulas[e]="",dieTotals[e]="",void(t.value="");dieFormulas[e]!=t.value&&(dieFormulas[e]=t.value,dieTotals[e]="")}attachEvents();